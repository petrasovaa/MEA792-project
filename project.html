<section>
<h3>Motivation</h3>
<ul>
<li>We want to have the latest, high resolution DSM/DEM,
but we don't have it for the entire study area.</li>
<li> We need to replace DEM with DSM and vice versa.</li>
</ul>
</section>

<section>
<h3>Use cases</h3>
<ul>
<li>Fusion of lidar and UAV data for watersheds and water flow modeling</li>
<li>Fusion of UAV data from different times for water flow modeling</li>
<li>Fusion of lidar and scanned data with Tangible Landscape</li>
</ul>
</section>

<section class="textimg">
<h3>Lidar and UAV</h3>

Raster-based fusion uses linear combination of lidar and UAV:<br>
$z_f = d \cdot z_{UAV} + (1 âˆ’ d) \cdot z_{lidar} \quad d\in \langle0, 1\rangle$
<br>
<img width="50%" src="img/fusion_distance.png">
<br><br>
r.grow.distance<br> + <br>r.mapcalc<br>
</section>

<section>
<img src="img/smooth.gif">
</section>


<section>
<img width="80%" src="img/fusion_depth_pause.gif">
</section>

<section>
<h3>r.patch.smooth</h3>
<pre>
g.extension r.patch.smooth url=https://github.com/petrasovaa/r.patch.smooth

r.patch.smooth --h

Description:
 Module for patching rasters with smoothing along edges

Keywords:
 raster, patch

Usage:
 r.patch.smooth.py input=name[,name,...] output=name smooth_dist=value
   [--overwrite] [--help] [--verbose] [--quiet] [--ui]

Flags:
 --o   Allow output files to overwrite existing files
 --h   Print usage summary
 --v   Verbose module output
 --q   Quiet module output
 --ui  Force launching GUI dialog

Parameters:
        input   Name of input raster map(s)
       output   Name for output raster map
  smooth_dist   Smoothing distance
</pre>
</section>

<section>
<h3>Fusion of UAV data from March and June</h3>
<img width="100%" src="img/march.png">

</section>

<section>
<h3>Method 1: Minimum raster</h3>
<pre><code>r.series input=march,june output=march_june_min,march_june_minraster 
    method=minimum,min_raster
</code></pre>
<img width="80%" src="img/min.jpg">
</section>

<section class="textimg">
<h3>Derived mask</h3>
<p style="text-align:center">
r.series method=min_raster <br> 
</p>

<img width="60%" src="img/mask.png">
</section>

<section class="textimg">
<h3>Derived mask</h3>
<p style="text-align:center">
r.series method=min_raster <br> + <br>
r.neighbors
</p>

<img width="60%" src="img/mask_sm.png">
</section>

<section>
<h3>Method 2: Import points with mask and interpolate</h3>
<ul>
<li>new v.in.lidar mask option for importing point with vector area</li>
<li>mask vector created using r.series</li>
<li>buffer on both sides to avoid discontinuities at the edge</li>
</ul>
<img width="80%" src="img/points.png">
</section>

<section>
<img width="100%" src="img/mask_interp.jpg">
</section>

<section>
<h3>Method 3: random sampling</h3>
<ul>
<li>patch rasters</li>
<li>r.random for random sampling</li>
<li>interpolate</li>
</ul>
</section>
<section>
<img width="100%" src="img/sampling.jpg">
</section>

<section>
<h3>Fusion summary</h3>
<ul>
<li>raster-based weighted average fusion
<ul><li>time efficient</li>
    <li>works best when edges are bare ground</li>
</ul>
<li>it is important to derive accurate mask</li>
<li>random sampling method gives best results, but not significantly better
than importing points with mask </li>
<ul><li>takes a more time</li>
<li>needs sufficient  number of random points, otherwise we will miss features</li>
<li>suitable when we don't have original point clouds</li>
</ul>
</ul>
</section>

<section class="textimg">
<h3>Tangible Landscape fusion application</h3>
<div>
Physical model of Mid Pines gully
<ul><li>scale 1 : 420</li>
<li>4 times vertical exaggeration</li>
</ul></div>
<img width="100%" src="img/model_ortho.png">
</section>

<section class="textimg">
<h3>Tangible Landscape fusion application</h3>
<div>
Physical model of Mid Pines gully
<ul><li>scale  1 : 420</li>
<li>4 times vertical exaggeration</li>
<li>built by projecting contours and difference</li>
</ul></div>
<img width="100%" src="img/diff1.png">
</section>

<section >
<h3>Watersheds (based on lidar)</h3>
<img width="70%" src="img/model_ortho_all.jpg">
</section>

<section>
<h3>r.sim.water on fused DEM</h3>
<img width="80%" src="img/flow1_detail.JPG">
</section>
<section>
<h3>Modification</h3>
<img width="70%" src="img/modify.JPG">
</section>

<section>
<h3>r.sim.water on changed DEM</h3>
<img width="80%" src="img/flow2.JPG">
</section>

<section>
<h3>Difference</h3>
<img width="80%" src="img/diff2.JPG">
</section>

<section>
<h3>Fusion</h3>
<img width="40%" src="img/fusion.png">
</section>

<section>
<h3>When DSMs don't match</h3>
From difference map (e.g. UAV DSM and lidar DEM) we can compute
 smoothed difference and subtract it from UAV DSM to align 2 elevation models
<img width="100%" src="img/distortion.png">
</section>